<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¯æ„›æœ‰è²æ•¸æ„Ÿå­¸ç¿’å–® (éŸ¿æ‡‰å¼é€²ä½æŒ‘æˆ°ç‰ˆ)</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Varela+Round&family=Noto+Sans+TC:wght@400;700&display=swap');

        body {
            font-family: 'Varela Round', 'Noto Sans TC', sans-serif;
            background-color: #FFF5E1; /* æº«æš–çš„ç±³é»ƒè‰²èƒŒæ™¯ */
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px; /* ç¨å¾®æ¸›å°‘å¤–éƒ¨ padding */
            margin: 0;
            color: #5D4037;
        }

        /* è¨­å®šé¢æ¿æ¨£å¼ */
        .settings-panel {
            background-color: #FFECB3;
            padding: 15px 25px; /* ç¨å¾®æ¸›å°‘ padding */
            border-radius: 20px;
            border: 3px solid #FFCC80;
            margin-bottom: 25px; /* ç¨å¾®æ¸›å°‘ margin */
            display: flex;
            gap: 15px; /* ç¨å¾®æ¸›å°‘é–“è· */
            align-items: center;
            flex-wrap: wrap;
            justify-content: center;
            box-shadow: 0 4px 10px rgba(0,0,0,0.05);
        }
        
        .input-group {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }
        
        .input-group label {
            font-weight: bold;
            color: #8D6E63;
            font-size: 13px; /* ç¨å¾®ç¸®å°å­—é«” */
        }

        input[type="number"] {
            padding: 8px; /* ç¨å¾®ç¸®å° padding */
            border-radius: 8px;
            border: 2px solid #FFCC80;
            font-size: 16px; /* ç¨å¾®ç¸®å°å­—é«” */
            width: 70px; /* ç¨å¾®ç¸®å°å¯¬åº¦ */
            text-align: center;
            font-family: inherit;
            color: #5D4037;
        }

        /* ä¸»è¦ç´™å¼µå®¹å™¨ - A4 æ¯”ä¾‹å„ªåŒ–å’ŒéŸ¿æ‡‰å¼èª¿æ•´ */
        .paper-container {
            background-color: white;
            padding: 40px 30px; /* èª¿æ•´ padding */
            border-radius: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            width: 95%; /* è®“å®¹å™¨ä½”æ»¿æ›´å¤šå¯ç”¨å¯¬åº¦ */
            max-width: 960px; /* å¢åŠ æœ€å¤§å¯¬åº¦ */
            text-align: center;
            border: 4px dashed #FFCC80;
            position: relative;
            box-sizing: border-box;
        }

        /* å¯æ„›è£é£¾ */
        .deco {
            position: absolute;
            font-size: 2.5rem; /* ç¨å¾®ç¸®å°å­—é«” */
            z-index: 1;
            pointer-events: none;
        }
        .deco-1 { top: -20px; left: -20px; transform: rotate(-20deg); }
        .deco-2 { top: -20px; right: -20px; transform: rotate(20deg); }
        .deco-3 { bottom: -10px; left: 15px; font-size: 1.8rem;} /* ç¨å¾®ç¸®å°å­—é«” */
        .deco-4 { bottom: -10px; right: 15px; font-size: 1.8rem;} /* ç¨å¾®ç¸®å°å­—é«” */

        h1 {
            color: #FF8A65;
            margin: 0 0 12px 0; /* èª¿æ•´ margin */
            font-size: 28px; /* èª¿æ•´å­—é«”å¤§å° */
            letter-spacing: 2px;
        }

        p.instruction {
            color: #8D6E63;
            margin-bottom: 25px; /* èª¿æ•´ margin */
            font-size: 16px; /* èª¿æ•´å­—é«”å¤§å° */
        }

        /* å­¸ç”Ÿè³‡æ–™æ¬„ */
        .student-info {
            display: flex;
            justify-content: center;
            gap: 40px; /* èª¿æ•´é–“è· */
            margin-bottom: 35px; /* èª¿æ•´ margin */
            font-size: 18px; /* èª¿æ•´å­—é«”å¤§å° */
            color: #5D4037;
        }
        .student-info span {
            border-bottom: 2px solid #FFCC80;
            padding-bottom: 4px;
            min-width: 160px;
            display: inline-block;
        }

        /* è¡¨æ ¼ç¶²æ ¼è¨­å®š - ç¢ºä¿ä¸€è¡Œ10æ ¼çš„éŸ¿æ‡‰å¼è¨­è¨ˆ */
        .grid-wrapper {
            display: grid;
            grid-template-columns: repeat(10, 1fr); /* æ ¸å¿ƒï¼šæ°¸é æ˜¯10ç­‰ä»½ */
            gap: 10px; /* èª¿æ•´é–“è· */
            margin: 0 auto;
            background-color: #FFF8E1;
            padding: 20px; /* èª¿æ•´ padding */
            border-radius: 20px;
            width: calc(100% - 40px); /* è®“ grid-wrapper ä½”æ»¿ paper-container å¯¬åº¦ï¼Œæ¸›å» padding */
            box-sizing: border-box;
            max-width: 900px; /* è¨­ç½®ä¸€å€‹æœ€å¤§å¯¬åº¦ï¼Œé¿å…éå¤§ */
        }

        .cell {
            /* è®“æ ¼å­é«˜åº¦èˆ‡å¯¬åº¦ç›¸ç­‰ï¼ŒéŸ¿æ‡‰å¼èª¿æ•´ */
            aspect-ratio: 1 / 1; 
            min-width: 40px; /* æœ€å°å¯¬åº¦ï¼Œé¿å…åœ¨æ¥µå°è¢å¹•ä¸‹éæ–¼å£“ç¸® */
            min-height: 40px; /* æœ€å°é«˜åº¦ */
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px; /* èª¿æ•´å­—é«”å¤§å° */
            border-radius: 12px;
            position: relative;
            box-shadow: 2px 2px 5px rgba(0,0,0,0.05);
            cursor: pointer;
            transition: transform 0.1s, background-color 0.2s;
            user-select: none;
        }

        .cell:active { transform: scale(0.95); }

        .cell.speaking {
            box-shadow: 0 0 12px #FF8A65; /* èª¿æ•´é™°å½±å¤§å° */
            border-color: #FF8A65 !important;
            z-index: 2;
        }

        /* å¡«å¥½çš„æ•¸å­—æ¨£å¼ (é¡Œç›®) */
        .cell.filled {
            background-color: #C5E1A5;
            color: #33691E;
            font-weight: bold;
            border: 2px solid #AED581; /* èª¿æ•´é‚Šæ¡†å¯¬åº¦ */
        }

        /* æŒ–ç©ºæ ¼å­æ¨£å¼ (è®“å­¸ç”Ÿå¡«) */
        .cell.empty {
            background-color: #FFFFFF;
            border: 2px dashed #FFAB91; /* èª¿æ•´é‚Šæ¡†å¯¬åº¦ */
        }
        
        /* æ§åˆ¶æŒ‰éˆ•å€ */
        .controls {
            margin-top: 30px; /* èª¿æ•´ margin */
            display: flex;
            gap: 20px; /* èª¿æ•´é–“è· */
            justify-content: center;
            padding-bottom: 20px; /* èª¿æ•´ padding */
        }

        button {
            padding: 10px 20px; /* èª¿æ•´ padding */
            font-size: 16px; /* èª¿æ•´å­—é«”å¤§å° */
            border-radius: 40px; /* èª¿æ•´åœ“è§’ */
            box-shadow: 0 3px #ccc; /* èª¿æ•´é™°å½± */
        }
        button:active { box-shadow: 0 1px #999; transform: translateY(1px); }

        .btn-update { background-color: #FFB74D; color: white; }
        .btn-update:hover { background-color: #FFA726; }
        .btn-regen { background-color: #4DB6AC; color: white; }
        .btn-regen:hover { background-color: #26A69A; }
        .btn-print { background-color: #FF8A65; color: white; }
        .btn-print:hover { background-color: #F4511E; }
        
        /* èªéŸ³å’Œæ–¹å‘æŒ‰éˆ•çš„æ¨£å¼ */
        .btn-toggle { background-color: #90A4AE; color: white; }
        .btn-toggle.active { background-color: #29B6F6; }
        .btn-toggle:hover { background-color: #607D8B; }

        /* åˆ—å°å°ˆç”¨è¨­å®š - é‡å° A4 å„ªåŒ– */
        @media print {
            @page { size: A4 portrait; margin: 1cm; }
            body { background-color: white; padding: 0; margin: 0; }
            .settings-panel, .controls, .deco { display: none !important; }
            .paper-container {
                box-shadow: none; border: none; width: 100%; max-width: 100%; padding: 0; margin: 0 auto;
            }
            .grid-wrapper { 
                gap: 6px; /* åˆ—å°æ™‚ç¨å¾®ç¸®å°é–“è· */
                padding: 8px; /* åˆ—å°æ™‚ç¨å¾®ç¸®å° padding */
                background-color: transparent; display: grid; width: 95%;
            }
            .cell {
                width: auto; height: 50px; /* åˆ—å°æ™‚é«˜åº¦å¯èª¿æ•´ */
                aspect-ratio: 1 / 1; 
                font-size: 20px; /* åˆ—å°æ™‚å­—é«”å¤§å° */
                border-width: 1.5px; /* åˆ—å°æ™‚é‚Šæ¡†ç²—ç´° */
                -webkit-print-color-adjust: exact; print-color-adjust: exact;
                page-break-inside: avoid; box-shadow: none;
            }
            .cell.empty { border-color: #aaa; border-style: dashed;}
            h1 { font-size: 26px; margin-bottom: 12px; color: #333 !important;}
            p.instruction { font-size: 15px; margin-bottom: 18px; color: #666 !important;}
            .student-info { margin-bottom: 25px; color: #333 !important; gap: 30px;}
        }

        /* é‡å°å°è¢å¹•ï¼ˆä¾‹å¦‚æ‰‹æ©Ÿï¼‰é€²ä¸€æ­¥å„ªåŒ– */
        @media (max-width: 768px) {
            body { padding: 10px; }
            .settings-panel { 
                padding: 10px 15px; 
                gap: 10px; 
                flex-direction: column; /* åœ¨å°è¢å¹•ä¸Šå‚ç›´æ’åˆ—è¨­å®šé¸é … */
                align-items: stretch;
            }
            .input-group { flex-direction: row; justify-content: space-between; align-items: center; }
            input[type="number"] { width: 60px; font-size: 15px; padding: 6px; }

            .paper-container { padding: 25px 15px; border-radius: 20px; }
            h1 { font-size: 24px; margin-bottom: 10px; }
            p.instruction { font-size: 14px; margin-bottom: 20px; }
            .student-info { flex-direction: column; gap: 15px; margin-bottom: 25px; font-size: 16px;}
            .student-info span { min-width: unset; width: 100%; text-align: left; }

            .grid-wrapper { padding: 10px; gap: 5px; }
            .cell { font-size: 16px; min-width: 30px; min-height: 30px; border-radius: 8px; }
            .controls { flex-wrap: wrap; gap: 10px; margin-top: 20px; padding-bottom: 10px; }
            button { padding: 8px 15px; font-size: 14px; border-radius: 30px; }

            .deco { font-size: 2rem; }
            .deco-1 { top: -15px; left: -15px; }
            .deco-2 { top: -15px; right: -15px; }
            .deco-3 { bottom: -8px; left: 10px; font-size: 1.5rem;}
            .deco-4 { bottom: -8px; right: 10px; font-size: 1.5rem;}
        }
    </style>
</head>
<body>

    <div class="settings-panel">
        <div class="input-group">
            <label for="startInput">èµ·å§‹ (Start)</label>
            <input type="number" id="startInput" value="77" min="1" max="200">
        </div>
        <div class="input-group">
            <label for="endInput">çµæŸ (End)</label>
            <input type="number" id="endInput" value="156" min="1" max="200">
        </div>
        <button class="btn-update" onclick="generateGrid()">âœ¨ å»ºç«‹è¡¨æ ¼</button>
        <button class="btn-toggle active" id="voiceToggle" onclick="toggleVoice()">ğŸ”Š èªéŸ³ï¼šé–‹</button>
        <button class="btn-toggle active" id="directionToggle" onclick="toggleDirection()">ğŸ“ˆ æ–¹å‘ï¼šæ­£æ•¸</button>
    </div>

    <div class="paper-container">
        <div class="deco deco-1">ğŸ»</div>
        <div class="deco deco-2">ğŸ°</div>
        <div class="deco deco-3">â­</div>
        <div class="deco deco-4">ğŸŒŸ</div>

        <h1 id="chartTitle">æ•¸æ•¸å°æŒ‘æˆ° (é€²ä½å¤§è€ƒé©—)</h1>
        
        <div class="student-info">
            <div>ç­ç´šï¼š<span></span></div>
            <div>å§“åï¼š<span></span></div>
        </div>

        <p class="instruction" id="instructionText">å°åµæ¢ï¼Œç‰¹åˆ¥æ³¨æ„ã€Œ9è·³åˆ°0ã€çš„åœ°æ–¹å–”ï¼(é»æ“Šæ ¼å­å¯ä»¥è½è²éŸ³)</p>

        <div class="grid-wrapper" id="numberGrid">
            </div>
    </div>

    <div class="controls">
        <button class="btn-regen" onclick="generateGrid()">ğŸ”„ é‡æ–°éš¨æ©Ÿ (9å’Œ0ä¿æŒæŒ–ç©º)</button>
        <button class="btn-print" onclick="window.print()">ğŸ–¨ï¸ åˆ—å° A4</button>
    </div>

    <script>
        // --- èªéŸ³åŠŸèƒ½è¨­å®š ---
        let isVoiceEnabled = true;
        const synth = window.speechSynthesis;

        function toggleVoice() {
            isVoiceEnabled = !isVoiceEnabled;
            const btn = document.getElementById('voiceToggle');
            if (isVoiceEnabled) {
                btn.textContent = "ğŸ”Š èªéŸ³ï¼šé–‹";
                btn.classList.add('active');
            } else {
                btn.textContent = "ğŸ”‡ èªéŸ³ï¼šé—œ";
                btn.classList.remove('active');
                synth.cancel();
            }
        }

        function speakNumber(number, cellElement) {
            if (!isVoiceEnabled || !synth) return;
            synth.cancel();
            document.querySelectorAll('.cell.speaking').forEach(c => c.classList.remove('speaking'));
            const utterance = new SpeechSynthesisUtterance(number.toString());
            utterance.lang = 'zh-TW';
            utterance.rate = 0.9;
            utterance.onstart = function() { cellElement.classList.add('speaking'); };
            utterance.onend = function() { cellElement.classList.remove('speaking'); };
            synth.speak(utterance);
        }

        // --- æ•¸æ•¸æ–¹å‘è¨­å®š ---
        let isAscending = true; // é è¨­ç‚ºæ­£æ•¸
        const instructionText = document.getElementById('instructionText');

        function toggleDirection() {
            isAscending = !isAscending;
            const btn = document.getElementById('directionToggle');
            if (isAscending) {
                btn.textContent = "ğŸ“ˆ æ–¹å‘ï¼šæ­£æ•¸";
                btn.classList.add('active');
                instructionText.textContent = "å°åµæ¢ï¼Œç‰¹åˆ¥æ³¨æ„ã€Œ9è·³åˆ°0ã€çš„åœ°æ–¹å–”ï¼(é»æ“Šæ ¼å­å¯ä»¥è½è²éŸ³)";
            } else {
                btn.textContent = "ğŸ“‰ æ–¹å‘ï¼šå€’æ•¸";
                btn.classList.remove('active');
                instructionText.textContent = "å°åµæ¢ï¼Œç‰¹åˆ¥æ³¨æ„ã€Œ0é€€åˆ°9ã€çš„åœ°æ–¹å–”ï¼(é»æ“Šæ ¼å­å¯ä»¥è½è²éŸ³)";
            }
            // åˆ‡æ›æ–¹å‘å¾Œï¼Œè‡ªå‹•é‡æ–°ç”Ÿæˆè¡¨æ ¼
            generateGrid(); 
        }

        // --- è¡¨æ ¼ç”Ÿæˆé‚è¼¯ ---
        function generateGrid() {
            const grid = document.getElementById('numberGrid');
            const title = document.getElementById('chartTitle');
            const startInput = document.getElementById('startInput');
            const endInput = document.getElementById('endInput');

            let startNum = parseInt(startInput.value);
            let endNum = parseInt(endInput.value);

            // é˜²å‘†é©—è­‰
            if (isNaN(startNum) || startNum < 1) { startNum = 1; startInput.value = 1; }
            if (isNaN(endNum) || endNum > 200) { endNum = 200; endInput.value = 200; }
            
            // æ ¹æ“šæ–¹å‘èª¿æ•´èµ·å§‹å’ŒçµæŸæ•¸å­—ï¼Œä¸¦çµ¦äºˆæç¤º
            if (isAscending) { // æ­£æ•¸
                if (startNum > endNum) {
                    alert("æ­£æ•¸æ¨¡å¼ä¸‹ï¼Œèµ·å§‹æ•¸å­—ä¸èƒ½æ¯”çµæŸæ•¸å­—å¤§å–”ï¼å·²è‡ªå‹•ä¿®æ­£ã€‚");
                    endNum = startNum + 19;
                    if (endNum > 200) endNum = 200;
                    endInput.value = endNum;
                }
            } else { // å€’æ•¸
                if (startNum < endNum) {
                    alert("å€’æ•¸æ¨¡å¼ä¸‹ï¼Œèµ·å§‹æ•¸å­—å¿…é ˆæ¯”çµæŸæ•¸å­—å¤§å–”ï¼å·²è‡ªå‹•ä¿®æ­£ã€‚");
                    startNum = endNum + 19; 
                    if (startNum > 200) startNum = 200;
                    startInput.value = startNum;
                }
            }
            
            // è¨ˆç®—ç¸½æ ¼å­æ•¸
            const totalCells = Math.abs(endNum - startNum) + 1;

            // æ›´æ–°æ¨™é¡Œ
            const directionText = isAscending ? "æ­£æ•¸" : "å€’æ•¸";
            title.textContent = `æ•¸æ•¸å°æŒ‘æˆ° (${directionText}é€²ä½å¤§è€ƒé©—)ï¼šå¾ ${startNum} æ•¸åˆ° ${endNum}`;
            grid.innerHTML = ''; 

            for (let i = 0; i < totalCells; i++) {
                let currentNum;
                if (isAscending) {
                    currentNum = startNum + i;
                } else { // å€’æ•¸
                    currentNum = startNum - i;
                }
                
                const cell = document.createElement('div');
                
                // --- æŒ–ç©ºé‚è¼¯ ---
                const endsIn9 = currentNum % 10 === 9; 
                const endsIn0 = currentNum % 10 === 0; 
                const isStartOrEnd = (i === 0 || i === totalCells - 1);

                let cellType = 'filled'; 

                // è¦å‰‡ 1 (æœ€é«˜å„ªå…ˆç´š): å¦‚æœå€‹ä½æ•¸æ˜¯ 9 æˆ– 0ï¼Œå¼·åˆ¶æŒ–ç©º
                if (endsIn9 || endsIn0) {
                    cellType = 'empty';
                }
                // è¦å‰‡ 2: å…¶ä»–æ•¸å­—ï¼Œä¿ç•™èµ·é»å’Œçµ‚é»ä½œç‚ºéŒ¨é»(å¦‚æœå®ƒå€‘ä¸æ˜¯9æˆ–0)
                else if (isStartOrEnd) {
                    cellType = 'filled';
                }
                // è¦å‰‡ 3: å‰©ä¸‹çš„ä¸­é–“æ•¸å­—ï¼Œéš¨æ©ŸæŒ–ç©º (æ©Ÿç‡ 30%)
                else if (Math.random() < 0.3) {
                    cellType = 'empty';
                }

                // æ‡‰ç”¨æ¨£å¼ä¸¦ç¶å®šèªéŸ³
                if (cellType === 'empty') {
                    cell.className = 'cell empty';
                    cell.onclick = function() { speakNumber(currentNum, this); };
                } else {
                    cell.className = 'cell filled';
                    cell.textContent = currentNum;
                    cell.onclick = function() { speakNumber(currentNum, this); };
                }

                grid.appendChild(cell);
            }
        }

        window.onload = function() {
             generateGrid();
             synth.getVoices();
        };
        
    </script>
</body>
</html>